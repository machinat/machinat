---
title: Native UI and Postback
---

> General UI like `<p>...</p>` are supported on every chat platform,
> but you can use more native UI supported by the current platform.
> In this lesson, we will learn how to use them to provide amazing user experiences.
>
> _Time to accomplish: 10 minutes_

## Native Component

On most chat platforms, you can interact with users by widgets or actions.
In Machinat, they are available as **Native Component** of each platform.

Let's add a button in the meassge to list user's todos. Follow the
guide of the platform to edit `handleChat`:


import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs
  groupId="chat-platforms"
  defaultValue="messenger"
  values={[
    {label: 'Messenger', value: 'messenger'},
    {label: 'Telegram', value: 'telegram'},
    {label: 'LINE', value: 'line'}
  ]}>
  <TabItem value="messenger">

```tsx {2,18-27} title="src/handlers/handleChat.tsx"
import Machinat, { makeContainer } from '@machinat/core';
import * as Messenger from '@machinat/messenger/components';
// ...
    async (
      ctx: ChatEventContext & { event: { category: 'message' | 'postback' } }
    ) => {
      const { event, reply } = ctx;

      if (event.type === 'text') {
        const matchingAddTodo = event.text.match(/add(\s+todo)?(.*)/i);
        if (matchingAddTodo) {
          const todoName = matchingAddTodo[2].trim();
          return reply(
            <>
              <p>Todo "<b>{todoName}</b>" is added!</p>
              <Machinat.Pause time={1500} />

              <Messenger.ButtonTemplate
                buttons={
                  <Messenger.PostbackButton
                    title="Show Todos ðŸ“‘"
                    payload={JSON.stringify({ action: 'list' })}
                  />
                }
              >
                You have <b>{3}</b> todos now.
              </Messenger.ButtonTemplate>
            </>
          );
        }
      }
// ...
```

The tags like `Messenger.ButtonTemplate` are **Native Components**.
They represent special features that belongs to the Messenger platform only.

We use these Messenger native components above:

- `Messenger.ButtonTemplate` - sends a text message with buttons.
- `Messenger.PostbackButton` - a button to post the `payload` back.


  </TabItem>
  <TabItem value="telegram">


```tsx {2,18-29} title="src/handlers/handleChat.tsx"
import Machinat, { makeContainer } from '@machinat/core';
import * as Telegram from '@machinat/telegram/components';
// ...
    async (
      ctx: ChatEventContext & { event: { category: 'message' | 'postback' } }
    ) => {
      const { event, reply } = ctx;

      if (event.type === 'text') {
        const matchingAddTodo = event.text.match(/add(\s+todo)?(.*)/i);
        if (matchingAddTodo) {
          const todoName = matchingAddTodo[2].trim();
          return reply(
            <>
              <p>Todo "<b>{todoName}</b>" is added!</p>
              <Machinat.Pause time={1500} />

              <Telegram.Text
                replyMarkup={
                  <Telegram.InlineKeyboard>
                    <Telegram.CallbackButton
                      text="Show Todos ðŸ“‘"
                      data={JSON.stringify({ action: 'list' })}
                    />
                  </Telegram.InlineKeyboard>
                }
              >
                You have <b>{3}</b> todos now.
              </Telegram.Text>
            </>
          );
        }
      }
// ...
```

The tags like `Telegram.Text` are **Native Components**.
They represent special features that belongs to the Telegram platform only.

We use these Telegram native components above:

- `Telegram.Text` - sends a text message with more options.
- `Telegram.InlineKeyboard` - attach inline buttons below a message.
- `Telegram.CallbackButton` - a button to post the `data` back.


  </TabItem>
  <TabItem value="line">


```tsx {2,18-28} title="src/handlers/handleChat.tsx"
import Machinat, { makeContainer } from '@machinat/core';
import * as Line from '@machinat/line/components';
//...
  async (
    ctx: ChatEventContext & { event: { category: 'message' | 'postback' } }
  ) => {
    const { event, reply } = ctx;

    if (event.type === 'text') {
      const matchingAddTodo = event.text.match(/add(\s+todo)?(.*)/i);
      if (matchingAddTodo) {
        const todoName = matchingAddTodo[2].trim();
        return reply(
          <>
            <p>Todo "<b>{todoName}</b>" is added!</p>
            <Machinat.Pause time={1500} />

            <Line.ButtonTemplate
              altText="You have 3 todos now."
              actions={
                <Line.PostbackAction
                  label="Show Todos ðŸ“‘"
                  data={JSON.stringify({ action: 'list' })}
                />
              }
            >
              You have <b>{3}</b> todos now.
            </Line.ButtonTemplate>
          </>
        );
      }
    }
// ...
```

The tags like `Line.ButtonTemplate` are **Native Components**.
They represent special features that belongs to the LINE platform only.

We use these LINE native components above:

- `Line.ButtonTemplate` - sends a text message with buttons.
- `Line.PostbackAction` - a button to post the `data` back.


  </TabItem>
</Tabs>


:::info
If you are building a cross-platform app, reply according to the platform like:

```tsx {6-14}
//...
    <>
      <p>Todo "<b>{todoName}</b>" is added!</p>
      <Machinat.Pause time={1500} />

      {
        event.platform === 'messenger' ? (
          // messenger component
        ) : event.platform === 'telegram' ? (
          // telegram component
        ) : (
          <p>You have <b>{3}</b> todos now.</p>
        )
      }
    </>
//...
```
:::

Now a button should be attached on the replied message, like:

<img width={400} src={require("./assets/add-todo-with-list-button.png").default} />


### JSX Props

The attributes we put on the JSX element are **Props**. For
example:

```tsx {2,4-5}
    <Messenger.ButtonTemplate
      buttons={
        <Messenger.PostbackButton
          title="Show Todos ðŸ“‘"
          payload={JSON.stringify({ action: 'list' })}
        />
      }
    >
      You have <b>{3}</b> todos now.
    </Messenger.ButtonTemplate>
```

Props are used to pass values to the component. The value can be text (like `title`),
expression (like `payload`) or even another JSX element (like `buttons`).

The JSON encoded data `{ action: 'list' }` is set on the button.
We can use the data later to handle the postback event.

## Postback Event

When user tap the button, it triggers an event that post the data back.
We can handle it by adding these codes in `handleChat`:

```tsx {5-14} title="src/handlers/handleChat.tsx"
//...
  (getIntent, getUserProfile) =>
    async (ctx: ChatEventContext & { event: { category: 'message' |'postback' } }) => {
      const { event, reply } = ctx;
      const intent = await getIntent(event);

      if (intent.type === 'list') {
        return reply(
          <>
            <p>You have <b>3</b> todos:</p>
            <p>......</p>
          </>
        );
      }
//...
```

Try tapping the `Show Todos ðŸ“‘` button and you should see:

<img width={400} src={require("./assets/list-todo-1.png").default} />


#### Handle Data

To know what happen in the `getIntent` function,
check the `src/services/useIntent.ts` file and you'll see the following code:


<Tabs
  groupId="chat-platforms"
  defaultValue="messenger"
  values={[
    {label: 'Messenger', value: 'messenger'},
    {label: 'Telegram', value: 'telegram'},
    {label: 'LINE', value: 'line'},
  ]}>
  <TabItem value="messenger">


```ts title="src/services/useIntent.ts"
//...
if (
  event.platform === 'messenger' &&
    (event.type === 'quick_reply' || event.type === 'postback')
) {
  if (event.data) {
    const { action, ...payload } = JSON.parse(event.data);
    return {
      type: action,
      confidence: 1,
      payload,
    };
  }
}
//...
```

The `'postback'` event contains the data `{ action: 'list' }` we attached on the button.
We can get the data at `event.data` and reply according to it.


  </TabItem>
  <TabItem value="telegram">


```ts title="src/services/useIntent.ts"
//...
if (event.platform === 'telegram' && event.type === 'callback_query') {
  if (event.data) {
    const { action, ...payload } = JSON.parse(event.data);
    return {
      type: action,
      confidence: 1,
      payload,
    };
  }
}
//...
```

The `'callback_query'` event contains the data `{ action: 'list' }` we attached on the button.
We can get the data at `event.data` and reply according to it.


  </TabItem>
  <TabItem value="line">


```ts title="src/services/useIntent.ts"
//...
if (event.platform === 'line' && event.type === 'postback') {
  if (event.data) {
    const { action, ...payload } = JSON.parse(event.data);
    return {
      type: action,
      confidence: 1,
      payload,
    };
  }
}
//...
```

The `'postback'` event contains the data `{ action: 'list' }` we attached on the button.
We can get the data at `event.data` and reply according to it.


  </TabItem>
</Tabs>

---

Our bot can interact with user by buttons and postback. Next, we'll learn
how to make more complex UI with components.
